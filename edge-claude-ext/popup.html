<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      width: 360px;
      max-height: 580px;
      overflow-y: auto;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: #0d1117;
      color: #c9d1d9;
      font-size: 13px;
    }

    /* Header */
    .header {
      padding: 14px 16px;
      background: linear-gradient(135deg, #161b22, #1c2333);
      border-bottom: 1px solid #21262d;
      display: flex;
      align-items: center;
      gap: 10px;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .header-icon {
      width: 32px; height: 32px;
      border-radius: 8px;
      background: linear-gradient(135deg, #7c3aed, #2563eb);
      display: flex; align-items: center; justify-content: center;
      font-size: 16px; flex-shrink: 0;
    }
    .header-title { font-size: 15px; font-weight: 600; color: #f0f6fc; }
    .header-sub { font-size: 11px; color: #8b949e; }

    /* Status bar */
    .status-bar {
      display: flex; align-items: center; gap: 8px;
      padding: 10px 16px;
      background: #161b22;
      border-bottom: 1px solid #21262d;
    }
    .status-dot {
      width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0;
    }
    .status-dot.connected { background: #3fb950; box-shadow: 0 0 6px #3fb95066; }
    .status-dot.connecting { background: #d29922; animation: pulse 1s infinite; }
    .status-dot.disconnected { background: #f85149; }
    @keyframes pulse { 0%,100% { opacity:1 } 50% { opacity:0.3 } }
    .status-text { flex: 1; font-weight: 500; }
    .status-detail { font-size: 11px; color: #8b949e; font-family: monospace; }

    /* Tabs */
    .tab-bar {
      display: flex;
      background: #161b22;
      border-bottom: 1px solid #21262d;
    }
    .tab-btn {
      flex: 1;
      padding: 8px 4px;
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      color: #8b949e;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      text-align: center;
    }
    .tab-btn:hover { color: #c9d1d9; }
    .tab-btn.active {
      color: #58a6ff;
      border-bottom-color: #58a6ff;
    }

    /* Panels */
    .panel { display: none; padding: 12px 16px; }
    .panel.active { display: block; }

    /* Stats grid */
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 12px;
    }
    .stat-card {
      padding: 10px;
      background: #161b22;
      border: 1px solid #21262d;
      border-radius: 8px;
    }
    .stat-val {
      font-size: 20px;
      font-weight: 700;
      color: #f0f6fc;
      font-family: monospace;
    }
    .stat-label {
      font-size: 10px;
      color: #8b949e;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 2px;
    }

    /* Test suite */
    .test-list { display: flex; flex-direction: column; gap: 6px; }
    .test-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      background: #161b22;
      border: 1px solid #21262d;
      border-radius: 6px;
      cursor: pointer;
      transition: border-color 0.15s;
    }
    .test-item:hover { border-color: #30363d; }
    .test-item.running { border-color: #d29922; }
    .test-item.pass { border-color: #3fb950; }
    .test-item.fail { border-color: #f85149; }
    .test-icon { font-size: 16px; width: 20px; text-align: center; flex-shrink: 0; }
    .test-name { flex: 1; font-weight: 500; font-size: 12px; }
    .test-detail { font-size: 10px; color: #8b949e; max-width: 140px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .test-ms { font-size: 10px; color: #8b949e; font-family: monospace; min-width: 40px; text-align: right; }

    /* Log viewer */
    .log-container {
      background: #010409;
      border: 1px solid #21262d;
      border-radius: 6px;
      max-height: 280px;
      overflow-y: auto;
      font-family: "SF Mono", "Fira Code", monospace;
      font-size: 10px;
      line-height: 1.6;
    }
    .log-entry {
      padding: 2px 8px;
      border-bottom: 1px solid #21262d0a;
      display: flex;
      gap: 6px;
    }
    .log-entry:hover { background: #161b2240; }
    .log-ts { color: #484f58; min-width: 65px; flex-shrink: 0; }
    .log-lvl { min-width: 36px; flex-shrink: 0; font-weight: 600; }
    .log-lvl.info { color: #58a6ff; }
    .log-lvl.warn { color: #d29922; }
    .log-lvl.error { color: #f85149; }
    .log-lvl.tool { color: #a5d6ff; }
    .log-lvl.ws { color: #7ee787; }
    .log-msg { color: #c9d1d9; word-break: break-all; }
    .log-data { color: #484f58; word-break: break-all; }

    /* Buttons */
    .btn {
      padding: 8px 14px;
      border-radius: 6px;
      border: 1px solid #30363d;
      background: #21262d;
      color: #c9d1d9;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.15s;
    }
    .btn:hover { background: #30363d; }
    .btn:active { background: #3a424d; }
    .btn-primary { background: #238636; border-color: #2ea043; color: #fff; }
    .btn-primary:hover { background: #2ea043; }
    .btn-danger { background: #da3633; border-color: #f85149; color: #fff; }
    .btn-danger:hover { background: #f85149; }
    .btn-row { display: flex; gap: 8px; margin-top: 12px; }
    .btn-row .btn { flex: 1; text-align: center; }

    /* Tab info */
    .tab-info-list { display: flex; flex-direction: column; gap: 4px; }
    .tab-info-item {
      padding: 6px 8px;
      background: #161b22;
      border: 1px solid #21262d;
      border-radius: 4px;
      font-size: 11px;
    }
    .tab-info-item .tab-url {
      color: #58a6ff;
      font-family: monospace;
      font-size: 10px;
      word-break: break-all;
    }
    .tab-info-item .tab-title { font-weight: 500; }
    .tab-active-badge {
      display: inline-block;
      padding: 1px 5px;
      border-radius: 3px;
      background: #238636;
      color: #fff;
      font-size: 9px;
      font-weight: 600;
      margin-left: 4px;
    }

    /* Summary bar */
    .test-summary {
      display: flex; gap: 12px; margin-bottom: 10px;
      padding: 8px 10px;
      background: #161b22;
      border-radius: 6px;
      border: 1px solid #21262d;
      font-size: 12px;
      align-items: center;
    }
    .test-summary .pass-count { color: #3fb950; font-weight: 600; }
    .test-summary .fail-count { color: #f85149; font-weight: 600; }
    .section-title {
      font-size: 11px; font-weight: 600; color: #8b949e;
      text-transform: uppercase; letter-spacing: 0.5px;
      margin: 12px 0 8px;
    }
    .section-title:first-child { margin-top: 0; }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-icon">&#9889;</div>
    <div>
      <div class="header-title">CFC Bridge</div>
      <div class="header-sub">Claude in Chrome &mdash; Edge Android</div>
    </div>
  </div>

  <!-- Status bar -->
  <div class="status-bar">
    <div class="status-dot" id="statusDot"></div>
    <span class="status-text" id="statusText">Loading...</span>
    <span class="status-detail" id="statusDetail"></span>
  </div>

  <!-- Tab navigation -->
  <div class="tab-bar">
    <button class="tab-btn active" data-panel="dashboard">Dashboard</button>
    <button class="tab-btn" data-panel="tests">Tests</button>
    <button class="tab-btn" data-panel="logs">Logs</button>
    <button class="tab-btn" data-panel="tabs">Tabs</button>
  </div>

  <!-- Dashboard panel -->
  <div class="panel active" id="panel-dashboard">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-val" id="stat-requests">0</div>
        <div class="stat-label">Tool Requests</div>
      </div>
      <div class="stat-card">
        <div class="stat-val" id="stat-errors">0</div>
        <div class="stat-label">Errors</div>
      </div>
      <div class="stat-card">
        <div class="stat-val" id="stat-uptime">--</div>
        <div class="stat-label">Connected</div>
      </div>
      <div class="stat-card">
        <div class="stat-val" id="stat-tabs">0</div>
        <div class="stat-label">Tabs</div>
      </div>
    </div>
    <div class="section-title">Last Tool</div>
    <div class="stat-card" style="margin-bottom:8px">
      <div style="font-size:12px;color:#f0f6fc;font-weight:500" id="stat-lasttool">None</div>
    </div>
    <div class="btn-row">
      <button class="btn btn-primary" id="btn-reconnect">Reconnect</button>
      <button class="btn" id="btn-launch-bridge">Launch Bridge</button>
    </div>
  </div>

  <!-- Tests panel -->
  <div class="panel" id="panel-tests">
    <div class="test-summary">
      <span>Results:</span>
      <span class="pass-count" id="test-pass-count">0 passed</span>
      <span class="fail-count" id="test-fail-count">0 failed</span>
      <span style="flex:1"></span>
      <button class="btn" id="btn-run-all" style="padding:4px 10px;font-size:11px">Run All</button>
    </div>
    <div class="test-list" id="test-list"></div>
  </div>

  <!-- Logs panel -->
  <div class="panel" id="panel-logs">
    <div style="display:flex;gap:8px;margin-bottom:8px;align-items:center">
      <span class="section-title" style="margin:0;flex:1">Message Log</span>
      <button class="btn" id="btn-refresh-logs" style="padding:4px 10px;font-size:11px">Refresh</button>
    </div>
    <div class="log-container" id="log-container"></div>
  </div>

  <!-- Tabs panel -->
  <div class="panel" id="panel-tabs">
    <div class="section-title">MCP Tab Group</div>
    <div class="tab-info-list" id="tab-info-list"></div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
